<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cotizador Quinta 2025 — Dashboard Dinámico</title>
<style>
  :root{
    --bg:#0f1320; --card:#171b2b; --muted:#9aa3b2; --text:#e9edf3; --accent:#7dd3fc; --ok:#4ade80; --warn:#fbbf24;
    --border:#232841;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial; background:linear-gradient(180deg,#0e1220 0%,#0b0f1a 100%); color:var(--text);}
  .wrap{max-width:1100px; margin:40px auto; padding:0 16px;}
  h1{font-size:28px; margin:0 0 6px; letter-spacing:.3px}
  .sub{color:var(--muted); margin-bottom:20px}
  .grid{display:grid; grid-template-columns:1.2fr 1fr; gap:18px}
  @media (max-width:920px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .head{display:flex; align-items:center; justify-content:space-between; gap:12px}
  .pill{font-size:12px; color:#0b1220; background:var(--accent); padding:4px 8px; border-radius:999px; font-weight:600}
  label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px}
  input, select{width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--border); background:#101526; color:var(--text); outline:none}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .row3{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
  .mt{margin-top:12px}
  .btns{display:flex; gap:10px; flex-wrap:wrap}
  button{cursor:pointer; border:none; padding:12px 14px; border-radius:12px; background:#1b2240; color:var(--text); font-weight:600}
  button.primary{background:linear-gradient(135deg,#38bdf8,#3b82f6)}
  button.ghost{background:#111628}
  .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
  @media (max-width:760px){.kpis{grid-template-columns:1fr}}
  .kpi{background:#101526; border:1px dashed var(--border); padding:14px; border-radius:14px}
  .kpi small{color:var(--muted); display:block}
  .kpi .big{font-size:24px; font-weight:800; margin-top:2px}
  .kpi.ok .big{color:var(--ok)} .kpi.warn .big{color:var(--warn)}
  table{width:100%; border-collapse:collapse; margin-top:8px; font-size:14px}
  th,td{padding:10px; border-bottom:1px solid var(--border)}
  th{text-align:left; color:var(--muted); font-weight:600}
  td.r{text-align:right}
  .footnote{color:var(--muted); font-size:12px; margin-top:10px}
  .badge{display:inline-block; font-size:12px; padding:4px 8px; border-radius:10px; background:#0f1a34; border:1px solid var(--border); color:var(--muted)}
  .flex{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .sep{height:1px; background:var(--border); margin:12px 0}
</style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div>
        <h1>Dashboard de Cotización — Quinta 2025</h1>
        <div class="sub">Calcula total por rango de fechas y número de personas. Auto-clasifica L-J / V / S-D y usa tarifa por bimestre.</div>
      </div>
      <span class="pill">v1.0</span>
    </div>

    <div class="grid">
      <!-- Panel de entradas -->
      <div class="card">
        <div class="flex" style="justify-content:space-between">
          <strong>Parámetros</strong>
          <span class="badge">MXN — IVA incluido (si aplica)</span>
        </div>
        <div class="row mt">
          <div>
            <label>Fecha inicio</label>
            <input type="date" id="startDate" />
          </div>
          <div>
            <label>Fecha fin (incluida)</label>
            <input type="date" id="endDate" />
          </div>
        </div>
        <div class="row mt">
          <div>
            <label>Número de personas</label>
            <select id="people">
              <!-- Solo los tramos de la tabla -->
              <option value="20">20</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="60">60</option>
              <option value="70">70</option>
              <option value="80">80</option>
              <option value="90">90</option>
              <option value="100">100</option>
            </select>
          </div>
          <div>
            <label>Modo de cálculo</label>
            <select id="mode">
              <option value="auto">Automático por día (recomendado)</option>
              <option value="manual">Manual: aplicar un tipo de día fijo</option>
            </select>
          </div>
        </div>
        <div class="row mt" id="manualRow" style="display:none">
          <div>
            <label>Tipo de día (solo si modo = manual)</label>
            <select id="dayType">
              <option value="LJ">Lunes a Jueves (L-J)</option>
              <option value="V">Viernes (V)</option>
              <option value="SD">Sábado o Domingo (S-D)</option>
            </select>
          </div>
          <div>
            <label>Bimestre (solo modo manual)</label>
            <select id="periodManual">
              <option value="Ene-Feb">Enero-Febrero</option>
              <option value="Mar-Abr">Marzo-Abril</option>
              <option value="May-Jun">Mayo-Junio</option>
              <option value="Jul-Ago">Julio-Agosto</option>
              <option value="Sep-Oct">Septiembre-Octubre</option>
              <option value="Nov-Dic">Noviembre-Diciembre</option>
            </select>
          </div>
        </div>
        <div class="btns mt">
          <button class="primary" id="calcBtn">Calcular</button>
          <button class="ghost" id="resetBtn">Reset</button>
          <button id="copyBtn">Copiar cotización</button>
          <button onclick="window.print()">Imprimir</button>
        </div>
        <div class="footnote">Notas: El cálculo <b>auto</b> detecta el tipo de día por fecha (L-J / V / S-D) y usa el <b>bimestre</b> correspondiente a cada fecha del rango 2025.</div>
      </div>

      <!-- KPIs -->
      <div class="card">
        <strong>Resultados</strong>
        <div class="kpis mt">
          <div class="kpi ok">
            <small>Total cotizado</small>
            <div class="big" id="total">$0</div>
          </div>
          <div class="kpi">
            <small>Días en rango</small>
            <div class="big" id="days">0</div>
          </div>
          <div class="kpi warn">
            <small>Personas</small>
            <div class="big" id="peopleOut">—</div>
          </div>
        </div>
        <div class="sep"></div>
        <div class="row3">
          <div class="kpi">
            <small>L-J (x<span id="cntLJ">0</span>)</small>
            <div class="big" id="sumLJ">$0</div>
          </div>
          <div class="kpi">
            <small>V (x<span id="cntV">0</span>)</small>
            <div class="big" id="sumV">$0</div>
          </div>
          <div class="kpi">
            <small>S-D (x<span id="cntSD">0</span>)</small>
            <div class="big" id="sumSD">$0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Desglose detallado -->
    <div class="card mt">
      <div class="head">
        <strong>Desglose por fecha (tarifa aplicada por bimestre)</strong>
        <span class="badge">2025</span>
      </div>
      <table id="breakdown">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Día</th>
            <th>Bimestre</th>
            <th>Tipo</th>
            <th class="r">Tarifa</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="footnote">Si el rango cruza bimestres, el sistema prorratea usando la tarifa de cada fecha según su bimestre.</div>
    </div>
  </div>

<script>
/** ====== Tabla de tarifas 2025 (según documento) ====== */
const DATA = {
  "Ene-Feb": {
    20:{LJ:2200,V:2400,SD:2800}, 30:{LJ:2350,V:2500,SD:3050}, 40:{LJ:2400,V:2600,SD:3200},
    50:{LJ:2500,V:2650,SD:3250}, 60:{LJ:2700,V:2900,SD:3500}, 70:{LJ:2800,V:2950,SD:3550},
    80:{LJ:2900,V:3000,SD:3700}, 90:{LJ:3000,V:3050,SD:3900}, 100:{LJ:3100,V:3200,SD:4100}
  },
  "Mar-Abr": {
    20:{LJ:2200,V:2400,SD:2800}, 30:{LJ:2350,V:2500,SD:3050}, 40:{LJ:2400,V:2600,SD:3200},
    50:{LJ:2500,V:2650,SD:3250}, 60:{LJ:2700,V:2850,SD:3500}, 70:{LJ:2750,V:2950,SD:3550},
    80:{LJ:2800,V:3000,SD:3600}, 90:{LJ:2850,V:3050,SD:3650}, 100:{LJ:2950,V:3100,SD:3700}
  },
  "May-Jun": {
    20:{LJ:2300,V:2450,SD:2900}, 30:{LJ:2400,V:2600,SD:3100}, 40:{LJ:2500,V:2650,SD:3200},
    50:{LJ:2600,V:2700,SD:3400}, 60:{LJ:2750,V:3000,SD:3600}, 70:{LJ:2850,V:3050,SD:3700},
    80:{LJ:2900,V:3100,SD:3750}, 90:{LJ:2950,V:3150,SD:3800}, 100:{LJ:3000,V:3200,SD:3850}
  },
  "Jul-Ago": {
    20:{LJ:2450,V:2650,SD:3100}, 30:{LJ:2600,V:2800,SD:3350}, 40:{LJ:2650,V:2850,SD:3450},
    50:{LJ:2800,V:2900,SD:3550}, 60:{LJ:3000,V:3200,SD:3850}, 70:{LJ:3050,V:3250,SD:3950},
    80:{LJ:3050,V:3300,SD:4000}, 90:{LJ:3150,V:3400,SD:4050}, 100:{LJ:3200,V:3450,SD:4100}
  },
  "Sep-Oct": {
    20:{LJ:2300,V:2450,SD:2900}, 30:{LJ:2400,V:2600,SD:3100}, 40:{LJ:2500,V:2750,SD:3200},
    50:{LJ:2600,V:2750,SD:3350}, 60:{LJ:2750,V:2950,SD:3600}, 70:{LJ:2850,V:3050,SD:3700},
    80:{LJ:2900,V:3100,SD:3750}, 90:{LJ:3000,V:3150,SD:3800}, 100:{LJ:3000,V:3200,SD:3850}
  },
  "Nov-Dic": {
    20:{LJ:2200,V:2400,SD:2800}, 30:{LJ:2350,V:2500,SD:3050}, 40:{LJ:2400,V:2600,SD:3200},
    50:{LJ:2500,V:2650,SD:3250}, 60:{LJ:2700,V:2900,SD:3500}, 70:{LJ:2800,V:2950,SD:3550},
    80:{LJ:2900,V:3000,SD:3700}, 90:{LJ:3000,V:3050,SD:3900}, 100:{LJ:3100,V:3200,SD:4100}
  }
};

const fmt = n => new Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}).format(n||0);

function dayTypeFromDate(d){
  const wd = d.getDay(); // 0=Dom, 1=Lun, ... 6=Sáb
  if (wd===5) return "V";       // Viernes
  if (wd===0 || wd===6) return "SD"; // Domingo o Sábado
  return "LJ";                  // Lunes-Jueves
}
function periodFromDate(d){
  const m = d.getMonth()+1;
  if (m<=2) return "Ene-Feb";
  if (m<=4) return "Mar-Abr";
  if (m<=6) return "May-Jun";
  if (m<=8) return "Jul-Ago";
  if (m<=10) return "Sep-Oct";
  return "Nov-Dic";
}
function eachDateInclusive(start,end,cb){
  const d=new Date(start.getFullYear(),start.getMonth(),start.getDate());
  const last=new Date(end.getFullYear(),end.getMonth(),end.getDate());
  while(d<=last){ cb(new Date(d)); d.setDate(d.getDate()+1); }
}
function validRange(a,b){
  return a instanceof Date && !isNaN(a) && b instanceof Date && !isNaN(b) && a<=b;
}

const el = s => document.querySelector(s);
const startDate = el('#startDate');
const endDate   = el('#endDate');
const peopleSel = el('#people');
const modeSel   = el('#mode');
const manualRow = el('#manualRow');
const dayTypeSel= el('#dayType');
const periodMan = el('#periodManual');

const totalEl   = el('#total');
const daysEl    = el('#days');
const peopleOut = el('#peopleOut');
const cntLJ     = el('#cntLJ');
const cntV      = el('#cntV');
const cntSD     = el('#cntSD');
const sumLJ     = el('#sumLJ');
const sumV      = el('#sumV');
const sumSD     = el('#sumSD');
const tbody     = el('#breakdown tbody');

modeSel.addEventListener('change', ()=>{ manualRow.style.display = modeSel.value==='manual' ? '' : 'none'; });

el('#resetBtn').addEventListener('click', ()=>{
  startDate.value = endDate.value = '';
  peopleSel.value = '20';
  modeSel.value = 'auto';
  manualRow.style.display='none';
  tbody.innerHTML='';
  [totalEl, sumLJ, sumV, sumSD].forEach(e=>e.textContent = fmt(0));
  [daysEl, cntLJ, cntV, cntSD].forEach(e=>e.textContent='0');
  peopleOut.textContent = '—';
});

function getRate(period, people, type){
  const bucket = DATA[period]?.[people];
  if(!bucket) return 0;
  return bucket[type] ?? 0;
}

el('#calcBtn').addEventListener('click', ()=>{
  const s = startDate.value ? new Date(startDate.value +'T00:00:00') : null;
  const e = endDate.value   ? new Date(endDate.value   +'T00:00:00') : null;
  const p = parseInt(peopleSel.value,10);

  tbody.innerHTML='';
  let sum=0, n=0, cLJ=0, cV=0, cSD=0, sLJ=0, sV=0, sSD=0;

  if (modeSel.value==='manual'){
    if (!p) return;
    const t = dayTypeSel.value;
    const per = periodMan.value;
    const rate = getRate(per,p,t);
    sum = rate;
    n = 1;
    cLJ = (t==='LJ')?1:0; cV = (t==='V')?1:0; cSD=(t==='SD')?1:0;
    sLJ = (t==='LJ')?rate:0; sV=(t==='V')?rate:0; sSD=(t==='SD')?rate:0;
    const row = `<tr><td>—</td><td>—</td><td>${per}</td><td>${t}</td><td class="r">${fmt(rate)}</td></tr>`;
    tbody.insertAdjacentHTML('beforeend',row);
  } else {
    if (!validRange(s,e)) { alert('Selecciona un rango de fechas válido.'); return; }
    eachDateInclusive(s,e,(d)=>{
      // Solo 2025 según las tablas
      if (d.getFullYear() !== 2025) return;
      const per = periodFromDate(d);
      const t = dayTypeFromDate(d);
      const r = getRate(per,p,t);
      n += 1; sum += r;
      if (t==='LJ'){ cLJ++; sLJ+=r; }
      if (t==='V'){  cV++;  sV+=r;  }
      if (t==='SD'){ cSD++; sSD+=r; }
      const day = d.toLocaleDateString('es-MX',{weekday:'short'});
      const ddmmyy = d.toLocaleDateString('es-MX');
      const row = `<tr><td>${ddmmyy}</td><td>${day.toUpperCase()}</td><td>${per}</td><td>${t}</td><td class="r">${fmt(r)}</td></tr>`;
      tbody.insertAdjacentHTML('beforeend',row);
    });
  }

  totalEl.textContent = fmt(sum);
  daysEl.textContent  = String(n);
  peopleOut.textContent = String(p);
  cntLJ.textContent = String(cLJ);
  cntV.textContent  = String(cV);
  cntSD.textContent = String(cSD);
  sumLJ.textContent = fmt(sLJ);
  sumV.textContent  = fmt(sV);
  sumSD.textContent = fmt(sSD);
});

el('#copyBtn').addEventListener('click', ()=>{
  const s = startDate.value || '—';
  const e = endDate.value || '—';
  const p = peopleSel.value;
  const txt = `Cotización Quinta 2025
Rango: ${s} a ${e}
Personas: ${p}
Total: ${totalEl.textContent}
Desglose: L-J ${cntLJ.textContent} días (${sumLJ.textContent}), V ${cntV.textContent} día(s) (${sumV.textContent}), S-D ${cntSD.textContent} día(s) (${sumSD.textContent})`;
  navigator.clipboard.writeText(txt).then(()=>{
    const old = document.title;
    document.title = '✅ Copiado';
    setTimeout(()=>document.title=old, 900);
  });
});

// Defaults de cortesía
(function preset(){
  // Propuesta de fin de semana cercano en 2025 (puedes cambiarlo)
  const year = 2025;
  const start = new Date(year,8,26); // 26 Sep 2025
  const end   = new Date(year,8,28); // 28 Sep 2025
  startDate.valueAsDate = start;
  endDate.valueAsDate = end;
})();
</script>
</body>
</html>
